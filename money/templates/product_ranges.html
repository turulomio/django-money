
{% extends 'base.html' %}

{% load i18n %}

{% block content %}
    <h1>{% trans 'Product ranges' %}</h1>
    <form method="post" class="form_table">
        <table>
        {% csrf_token %}
        {{ form.as_table }}
        </table>
        <button type="submit" name="button">{% trans "Show ranges" %}</button>
    </form>
<p>
{% if prm.product.basic_results.last %}
    <h2>{% trans 'Product ranges table' %}</h2>

    <p>{% trans "Current price: " %}{{prm.product.basic_results.last}}</p>
    
    {{prm.mytable| safe}} 
    <br>
  

    <h2>{% trans 'Product ranges chart' %}</h2>
    <div id="main" style="width: 80%;height:400px;"></div>
    <script type="text/javascript">
    
        function calculateMA(dayCount, data) {
            var result = [];
            for (var i = 0, len = data.length; i < len; i++) {
                if (i < dayCount) {
                    result.push('-');
                    continue;
                }
                var sum = 0;
                for (var j = 0; j < dayCount; j++) {
                    sum += data[i - j];
                }
                result.push(sum / dayCount);
            }
            return result;
        }
        
        // based on prepared DOM, initialize echarts instance
        var dates={{dates| safe}};
        var data={{closes}};
        var myChart = echarts.init(document.getElementById('main'));

        // specify chart configuration item and data

        var option = {
//             title: {
//                 text: 'Product ranges'
//             },
            legend: {
                data: ['{{prm.product.name}}', 'MA10', 'MA100'],
                inactiveColor: '#777',
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    animation: false,
                    type: 'cross',
                    lineStyle: {
                        color: '#376df4',
                        width: 2,
                        opacity: 1
                    }
                }
            },
            xAxis: {
                type: 'category',
                data: dates,
                axisLine: { lineStyle: { color: '#8392A5' } }
            },
            yAxis: {
                scale: true,
                axisLine: { lineStyle: { color: '#8392A5' } },
                splitLine: { show: false }
            },
            grid: {
                bottom: 80
            },
            dataZoom: [{
                textStyle: {
                    color: '#8392A5'
                },
                handleIcon: 'path://M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                dataBackground: {
                    areaStyle: {
                        color: '#8392A5'
                    },
                    lineStyle: {
                        opacity: 0.8,
                        color: '#8392A5'
                    }
                },
                brushSelect: true
            }, {
                type: 'inside'
            }],
            series: [
                {
                    type: 'line',
                    name: '{{prm.product.name}}',
                    data: data,
                },
//                 {
//                     type: 'line',
//                     data: [14000, 14000],
//                     tooltip: {
//                         show: false
//                     }
//                 },
                {
                    name: 'MA10',
                    type: 'line',
                    data: calculateMA(10, data),
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                },
                {
                    name: 'MA100',
                    type: 'line',
                    data: calculateMA(100, data),
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1
                    }
                }
            ]
        };
        // use configuration item and data specified to show chart
        myChart.setOption(option);
    </script>
  
{% endif %}
{% endblock %}
