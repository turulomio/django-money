{% extends 'base.html' %}
{% load i18n %}
{% load l10n %}

{% block content %}
    <h1>{% trans "Update an investment" %}</h1>
    <form method="post">
        <table>
        {% csrf_token %}
        {{ form.as_table }}
        </table>
    <button type="submit">{% trans "Save" %}</button>
    </form>
    
    <modal-window id="sellingprice" closed>
<h1>{% trans "Set selling price by percentage" %}</h1>
<input type="number" value="5" id="percentage">
 <button onclick="set_by_percentage()">{% trans "Set" %}</button> 
<h1>Set by GA</h1>

    <script>
    var dialog=document.getElementById("sellingprice");
    var txtSellingPrice=document.getElementById("id_selling_price");
    var txtPercentage=document.getElementById("percentage");
    var invested_user=parseFloat({{view.investments_operations.current_invested_user|unlocalize}});
    var leverage=parseFloat({{view.object.products.real_leveraged_multiplier}});
    var average_price_investment=parseFloat({{view.investments_operations.current_average_price_investment.amount}});
    var gains_investment=parseFloat({{view.investments_operations.current_gains_gross_investment}});
    var shares=parseFloat({{view.investments_operations.current_shares}});
    
    alert(`Invested: ${invested_user}
leverage: ${leverage}
average_price: ${average_price_investment}
gains_investment: ${gains_investment}
shares: ${shares}
`);
    
    function open_sellingprice_dialog(){
        dialog.show();
    }
    
    function set_by_percentage(){
        txtSellingPrice.value=selling_price_to_gain_percentage_of_invested(txtSellingPrice.value());
        dialog.close();
    }
    
    
    function selling_price_to_gain_percentage_of_invested(percentage){
        var gains=invested*txtPercentage.value();
        return self.selling_price_to_gain_money(gains);
    }

    function selling_price_to_gain_money(money){/*
        AveragePrice=self.average_price(eMoneyCurrency.Product).amount
        Gains=money.convert(self.investment.product.currency).amount
        Shares=abs(self.shares())

        if self.investment.op_actual.shares()>0:
            ## (PF - AveragePrice) 路 Shares路Leverage=Gains.  #Long position
            ## PF=(Gains+AveragePrice*Shares*Leverage)/(Shares*Leverage)
            PF=(Gains+AveragePrice*Shares*Leverage)/(Shares*Leverage) 
        elif self.investment.op_actual.shares()<0:#Short position
            ## (AveragePrice-PF) 路 Shares路Leverage=Gains.  #Short position
            ## PF=(-Gains+AveragePrice*Shares*Leverage)/(Shares*Leverage)
            PF=(-Gains+AveragePrice*Shares*Leverage)/(Shares*Leverage)
        else:
            PF=0
        return Money(self.mem, PF, self.investment.product.currency)*/
    }
    </script>
    </modal-window>
    

    
    <p class="orders">
        <a onclick="open_sellingprice_dialog();" href="javascript:void(0);">{% trans "Calculate selling price" %}</a> | 
        <a href="{% url 'investment_delete' pk=object.id %}">{% trans "Delete this investment" %}</a>
    </p>

{% endblock %}
