
{% extends 'base.html' %}
{% load i18n %}
{% load l10n %}

{% block content %}

<h1>{% blocktrans with investment=investment.name %}Investment details of '{{ investment }}'{% endblocktrans %}</h1>
<h2>{% trans "Investment operations" %}</h2>

<p><strong>{% trans 'Id' %}: </strong>{{ investment.id }}</p>
<p><strong>{% trans 'Name' %}: </strong>{{ investment.fullName }}</p>
<p><strong>{% trans 'Product Id' %}: </strong>{{ investment.products.fullName }}</p>
<p><strong>{% trans 'Active' %}: </strong>{{ investment.active }}</p>
<p><strong>{% trans 'Selling point' %}: </strong>{{ investment.selling_price }}
{% with gains_at_selling_price=operations.current_gains_gross_investment_at_selling_price %}  
  {% if gains_at_selling_price %}
      . {% blocktrans %} to gain {{ gains_at_selling_price }}.{% endblocktrans %}
  {% endif %}</p>
{% endwith %}
<p><strong>{% trans 'Selling expiration' %}: </strong>{{ investment.selling_expiration }}
  {% if investment.selling_expiration_alert %}
      . <span class="red">{% trans 'You must set a new selling order.' %}</span>
  {% endif %}</p>
<p><strong>{% trans 'Daily adjustment' %}: </strong>{{ investment.daily_adjustment }}</p>
<p><strong>{% trans 'Currency' %}: </strong>{{ investment.products.currency }} ({{ investment.products.currency_symbol }})</p>
<p><strong>{% trans 'Leverage' %}: </strong>{{ investment.products.leverages.multiplier }} (Real: {{investment.products.real_leveraged_multiplier}})</p>

<p class="orders">
  <a href="{% url 'investment_update' pk=investment.id %}">{% trans "Update this investment" %}</a> | 
  <a href="{% url 'investment_change_active' pk=investment.id %}">{% trans "Change active status" %}</a> | 
  <a href="{% url 'product_view' pk=investment.products.id %}">{% trans "Show product" %}</a> | 
  <a href="{% url 'quote_new' products_id=investment.products.id %}">{% trans "Add a quote to product" %}</a> | 
  <a href="{% url 'quote_delete_last' products_id=investment.products.id %}?next={% url 'investment_list_active' %}">{% trans "Delete last quote" %}</a> | 
</p>
<script>
  $( function() {
    $( "#tabs" ).tabs();
  } );
</script>
 
<div id="tabs">
  <ul>
    <li><a href="#tabs-2">{% trans "Current investment operations" %}</a></li>
    <li><a href="#tabs-1">{% trans "Investment operations" %}</a></li>
    <li><a href="#tabs-3">{% trans "Historical investment operations" %}</a></li>
    <li><a href="#tabs-4">{% trans "Dividends" %}</a></li>
  </ul>
 

  <div id="tabs-1">
      {{ operations.o_tabulator_homogeneus_investment.render | safe }}
  </div>


  <div id="tabs-2">
    {{ operations.current_tabulator_homogeneus_investment.render | safe }}
    {% if  investment.hasSameAccountCurrency is False %}
        {{ operations.current_tabulator_homogeneus_user.render | safe }}
    {%endif %}
  </div>

  <div id="tabs-3">
    {{ operations.historical_tabulator_homogeneus_investment.render |safe}}
    {% if  investment.hasSameAccountCurrency is False %}
        {{ operations.historical_tabulator_homogeneus_user.render | safe }}
    {%endif %}
    
    
    
    
    
  </div>
  <div id="tabs-4">
    {{ qso_dividends.tabulator.render |safe}}
  </div>
</div>
  <script>
    function newio_adjusting_cc(){
        var selling_price_product_currency=parseNumber(prompt( "{% trans "Please add the operation close price in product currency" %}", 0 ));
        var gains_account_currency=parseNumber(prompt( "{% trans "Please add the final gains in account currency" %}", 0 ));
        var shares=parseNumber("{{ operations.current_shares|unlocalize}}");
        var average_price_current_account=parseNumber("{{operations.current_average_price_account.amount|unlocalize}}");
        var leverage=parseNumber("{{operations.investment.products.real_leveraged_multiplier}}")
        
        var currency_conversion=(gains_account_currency+shares*average_price_current_account*leverage)/(shares*selling_price_product_currency*leverage)
        var url=`{% url 'investmentoperation_new' investments_id=investment.id %}?currency_conversion=${my_round(currency_conversion,10)}&price=${selling_price_product_currency}&shares=${-shares}`;
        window.location.href=url;
    };
  </script>        
  <p class="orders">
      <a href="{% url 'investmentoperation_new' investments_id=investment.id %}">{% trans "Add an investment operation" %}</a> | 
      <a onclick="newio_adjusting_cc()" href="#">{% trans "Add an investment operation adjusting currency conversion factor" %}</a> | 
      <a href="{% url 'dividend_new' investments_id=investment.id %}">{% trans "Add a dividend" %}</a>
  </p>
  

{% endblock %}
